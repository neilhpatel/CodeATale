let chapterStartPageNumber = [
  0,
  8,
  31,
  46,
  61,
  77,
  91,
  111,
  124,
  134,
  150,
  165,
  186,
  196,
  209,
  224,
  236,
  250,
  271,
  287,
  300
];

function increasePage(chapterNum, pageNum) {
  if (pageNum + 1 >= chapterStartPageNumber[parseInt(chapterNum, 10)]) { // Remember: since this is indexed from 0 this is the next chapter not the current one
    chapterNum++;
  }

  if (chapterNum >= 22) {return;}

  pageNum++;

  sessionStorage.setItem("chptNum", chapterNum);
  sessionStorage.setItem("pageNum", pageNum);
}

function decreasePage(chapterNum, pageNum) {
  if (pageNum - 1 < chapterStartPageNumber[chapterNum-1]) { // Remember: since this is indexed from 0 this is the current chapter
    chapterNum--;
  }

  if (chapterNum <= 0) {return;}

  pageNum--;

  sessionStorage.setItem("chptNum", chapterNum);
  sessionStorage.setItem("pageNum", pageNum);
}

function maintainPage() {
  return;
}

// **This function should probably be simplified/reworked.**
function updatePageText (chapter, page, modNums) {
  fetch("../../assets/json_files/parsedPages.json")
    .then((Response) => Response.json())
    .then((data) => {
      // console.log("chapter number " + chapter);
      // console.log("number of pages in chapter " + Object.keys(data[chapter-1]).length);
      // console.log(data[chapter-1]);
      // console.log("page number " + page);
      
      modNums(chapter, page);
      // Changes the page and chapter nums in system storage

      chapter = sessionStorage.getItem("chptNum");
      page = sessionStorage.getItem("pageNum");

      $("#reading-heading").html(`Chapter ${chapter}`);
      $(".page-number").html(`Page ${page}`);

      let str = data[parseInt(chapter-1, 10)][parseInt(page, 10)]
      .toString()
      .replace(/,/g, " ")
      .split(/\s+/)
      .map((w) => `<span class="highlight">${w}</span>`); // Note this removes all commas everywhere, which we don't want.

    str = str.toString().replace(/,/g, " "); // Note this is also needed to remove the commas that are generated by .split(" ")

    $(".main-text").html(str);

    // Adds on click funtion for each word individually
    $(".highlight").each(function() {
      $(this).click(function() {
        alert($(this).text());
      });
    });
  });
}

$("document").ready(function() {
  let chapterNum = parseInt(sessionStorage.getItem("chptNum"), 10);
  let pageNum = parseInt(sessionStorage.getItem("pageNum"), 10);
  // $("img").attr("src", `../../assets/chapter_images/chapter${chapterNum}.png`);
  updatePageText(chapterNum, pageNum, maintainPage);
});

const prevPage = $("#prevPg");
prevPage.click(() => {
  let chapterNum = parseInt(sessionStorage.getItem("chptNum"), 10);
  let pageNum = parseInt(sessionStorage.getItem("pageNum"), 10);

  updatePageText(chapterNum, pageNum, decreasePage);
  // $("img").attr("src", `../../assets/chapter_images/chapter${chapterNum}.png`); // Changes the chapter image
});

const nextPage = $("#nextPg");
nextPage.click(() => {
  let chapterNum = parseInt(sessionStorage.getItem("chptNum"), 10);
  let pageNum = parseInt(sessionStorage.getItem("pageNum"), 10);
  
  updatePageText(chapterNum, pageNum, increasePage);
  // $("img").attr("src", `../../assets/chapter_images/chapter${num}.png`); // Changes the chapter image
});
